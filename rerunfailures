Flaky-тесты или "мигающие" авто-тесты, т.е. такие тесты, которые по независящим от нас внешним
обстоятельствам или из-за трудновоспроизводимых багов, могут иногда падать, хотя всё остальное время они
проходят успешно. Это может происходить в момент прохождения тестов из-за одновременного обновления сайта,
из-за сетевых проблем или странных стечений обстоятельств. Конечно, надо стараться исключать такие проблемы
и искать причины возникновения багов, но в реальном мире бывает, что это требует слишком много усилий.
Поэтому мы будем перезапускать упавший тест, чтобы еще раз убедиться, что он действительно нашел баг,
а не упал случайно.

Это сделать очень просто. Для этого мы будем использовать плагин pytest-rerunfailures.


Сначала установим плагин в нашем виртуальном окружении. После установки плагин будет автоматически найден PyTest,
и можно будет пользоваться его функциональностью без дополнительных изменений кода:

pip install pytest-rerunfailures==7.0

Чтобы указать количество перезапусков для каждого из упавших тестов, нужно добавить в командную строку параметр:

"--reruns n", где n - это количество перезапусков. Если при повторных запусках тесты пройдут успешно,
то и прогон тестов будет считаться успешным. Количество перезапусков отображается в отчёте, благодаря
чему можно позже анализировать проблемные тесты.﻿﻿
Дополнительно мы указали параметр "--tb=line", чтобы сократить лог с результатами теста. Можете почитать
подробнее про настройку вывода в документации PyTest:

pytest -v --tb=line --reruns 1 --browser_name=chrome test_rerun.py
















